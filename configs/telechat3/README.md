# TeleChat3-105B

## æ¨¡å‹æè¿°

TeleChat3-105Bæ˜¯TeleChatç³»åˆ—æœ€æ–°ä¸€ä»£çš„ç¨€ç–å¤§æ¨¡å‹ã€‚åŸºäºåˆ›æ–°çš„è®­ç»ƒæ–¹å¼ï¼ŒTeleChat3åœ¨é€»è¾‘æ¨ç†ã€ä»£ç ç”Ÿæˆã€å¤šè¯­è¨€åŠæŒ‡ä»¤è·Ÿéšä¸Šå®ç°é˜¶è·ƒå¼æå‡ã€‚ä½œä¸ºé«˜æ•ˆè®­ç»ƒMoEç‰ˆæœ¬ï¼ŒTeleChat3-105Bé‡‡ç”¨ç»†ç²’åº¦çš„æ¨¡å‹åˆå§‹åŒ–æ–¹å¼å’Œå­¦ä¹ ç‡æ§åˆ¶ï¼ŒåŠ å¿«æ¨¡å‹åœ¨è®­ç»ƒåˆæœŸçš„æ”¶æ•›é€Ÿåº¦å¹¶å¢å¼ºæ¨¡å‹åœ¨è®­ç»ƒåˆçš„ç¨³å®šæ€§ï¼›åŸºäºä¸‰æ®µå¼è¯¾ç¨‹å­¦ä¹ æ–¹å¼ï¼ŒæŒç»­æå‡æ¨¡å‹æ•ˆæœã€‚é‡‡ç”¨å›½äº§ç®—åŠ›æ·±åº¦ä¼˜åŒ–é€šä¿¡æ•ˆç‡å¹¶å¼•å…¥äº†microçº§åˆ«çš„åŠ¨æ€æ‹¼æ¥ï¼Œç¼“è§£è®¡ç®—è´Ÿè½½çš„ä¸å‡è¡¡ï¼Œä¸ºåƒäº¿çº§å¤§æ¨¡å‹çš„å¤§è§„æ¨¡è®­ç»ƒä¸éƒ¨ç½²æä¾›è¡Œä¸šæ–°æ ‡æ†ã€‚

## æ”¯æŒè§„æ ¼

|    æ¨¡å‹åç§°    |    è§„æ ¼     | æ”¯æŒä»»åŠ¡ | æ¨¡å‹æ¶æ„  |                       æ”¯æŒè®¾å¤‡                        |        æ¨¡å‹çº§åˆ«         |
|:----------:|:---------:|:----:|:-----:|:-------------------------------------------------:|:-------------------:|
|TeleChat3    | 105B-A4.7B |  é¢„è®­ç»ƒ  | Mcore | Atlas 800T A2/Atlas 800I A2/Atlas 900 A3 SuperPoD | [Released](#æ¨¡å‹çº§åˆ«ä»‹ç») |

è¯´æ˜ï¼š

- æ¨¡å‹æ¶æ„ï¼š`Mcore` è¡¨ç¤º 1.6.0 å‘å¸ƒçš„æ–°æ¨¡å‹æ¶æ„ï¼Œ`Legacy` è¡¨ç¤ºåŸæœ‰æ¨¡å‹æ¶æ„ã€‚è¯¦è§[æ¶æ„è¯´æ˜](https://www.mindspore.cn/mindformers/docs/zh-CN/master/introduction/overview.html)ã€‚
- æ¨¡å‹çº§åˆ«ï¼šè®­ç»ƒå’Œæ¨ç†å„åˆ†ä¸º5ä¸ªçº§åˆ«ï¼Œåˆ†åˆ«ä»£è¡¨è¯¥æ¨¡å‹éµå¾ªä¸åŒçš„æ ‡å‡†ä¸Šçº¿ã€‚æ¯ä¸ªçº§åˆ«çš„ä»‹ç»è¯¦è§[æ¨¡å‹çº§åˆ«ä»‹ç»](https://gitee.com/mindspore/mindformers/blob/master/README_CN.md#æ¨¡å‹çº§åˆ«ä»‹ç»)ã€‚

## ç‰ˆæœ¬é…å¥—

TeleChat3 å½“å‰æ”¯æŒçš„ç‰ˆæœ¬é…å¥—å¦‚ä¸‹ã€‚

|           | Mindspore Transformers | MindSpore | CANN | HDK |
|:---------:|:----------------------:|:---------:|:----:|:---:|
| å½“å‰æ”¯æŒçš„ç‰ˆæœ¬ |           åœ¨ç ”ç‰ˆæœ¬           |    åœ¨ç ”ç‰ˆæœ¬     |  åœ¨ç ”ç‰ˆæœ¬  | åœ¨ç ”ç‰ˆæœ¬  |

### å‰æœŸå‡†å¤‡

#### ç¯å¢ƒå®‰è£…

æŒ‰ç…§ä¸Šè¿°ç‰ˆæœ¬é…å¥—ï¼Œå‚è€ƒ[ç¯å¢ƒå®‰è£…æŒ‡å—](https://www.mindspore.cn/mindformers/docs/zh-CN/master/installation.html)å®‰è£…è¿è¡Œç¯å¢ƒã€‚

#### æ¨¡å‹ä¸‹è½½

ç”¨æˆ·å¯ä»¥ä»Modelersã€Hugging Faceã€ModelScopeç­‰å¼€æºç¤¾åŒºä¸‹è½½æ‰€éœ€çš„æ¨¡å‹æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ¨¡å‹æƒé‡ã€Tokenizerã€é…ç½®ç­‰ï¼ˆé‡å¤´é¢„è®­ç»ƒä¸éœ€åŠ è½½æƒé‡ï¼‰ã€‚é“¾æ¥å¦‚ä¸‹ï¼š

|         æ¨¡å‹åç§°         | ä¸‹è½½é“¾æ¥                                             | è¯´æ˜ |
|:--------------------:|:-------------------------------------------------|:---|
|  TeleChat/TeleChat3-105B-A4.7B  | [ModelScope](https://modelscope.cn/models/TeleAI/TeleChat3-105B-A4.7B-Thinking/files)

#### æ•°æ®é›†ä¸‹è½½

MindSpore Transformers ä»¥ä¸‹é¢çš„æ•°æ®é›†ä¸ºä¾‹æä¾›äº† TeleChat3 çš„é¢„è®­ç»ƒæµç¨‹çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œå®é™…è®­ç»ƒæ—¶å¯å‚è€ƒ[æ•°æ®é›†](https://www.mindspore.cn/mindformers/docs/zh-CN/master/feature/dataset.html)ç« èŠ‚åˆ¶ä½œæ•°æ®é›†ã€‚è¯·åœ¨æ‰§è¡Œä»»åŠ¡å‰æå‰ä¸‹è½½æ‰€éœ€æ•°æ®é›†ã€‚é“¾æ¥å¦‚ä¸‹ï¼š

| ä»»åŠ¡  |    æ•°æ®é›†åç§°     | ä¸‹è½½é“¾æ¥         | è¯´æ˜ |
|:---:|:------------:|:-------------|:---|
| é¢„è®­ç»ƒ | WikiText-103 | [Download](https://dagshub.com/DagsHub/WIkiText-103/src/main/dataset/tokens/wiki.train.tokens) | ç”¨äºé¢„è®­ç»ƒçš„å¤§è§„æ¨¡æ–‡æœ¬æ•°æ®é›† |

### é¢„è®­ç»ƒæ ·ä¾‹

é¢„è®­ç»ƒæ˜¯æŒ‡åœ¨å¤§è§„æ¨¡æ— æ ‡æ³¨æ•°æ®ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿå…¨é¢æ•æ‰è¯­è¨€çš„å¹¿æ³›ç‰¹æ€§ã€‚åœ¨MindSporeå®˜ç½‘æä¾›äº†è¯¦ç»†çš„[æŒ‡å¯¼](https://www.mindspore.cn/mindformers/docs/zh-CN/master/guide/pre_training.html)ã€‚

#### 1. æ•°æ®é¢„å¤„ç†

MindSpore Transformers é¢„è®­ç»ƒé˜¶æ®µå½“å‰å·²æ”¯æŒ[Megatronæ ¼å¼çš„æ•°æ®é›†](https://www.mindspore.cn/mindformers/docs/zh-CN/master/feature/dataset.html#megatron%E6%95%B0%E6%8D%AE%E9%9B%86)ã€‚ç”¨æˆ·å¯ä»¥å‚è€ƒ[æ•°æ®é›†](https://www.mindspore.cn/mindformers/docs/zh-CN/master/feature/dataset.html)ç« èŠ‚ï¼Œä½¿ç”¨ MindSpore æä¾›çš„å·¥å…·å°†åŸå§‹æ•°æ®é›†è½¬æ¢ä¸º Megatron æ ¼å¼ã€‚

åˆ¶ä½œMegatronæ ¼å¼æ•°æ®é›†ï¼Œéœ€è¦ç»è¿‡ä¸¤ä¸ªæ­¥éª¤ã€‚é¦–å…ˆå°†åŸå§‹æ–‡æœ¬æ•°æ®é›†è½¬æ¢ä¸ºjsonlæ ¼å¼æ•°æ®ï¼Œç„¶åä½¿ç”¨MindSpore Transformersæä¾›çš„è„šæœ¬å°†jsonlæ ¼å¼æ•°æ®è½¬æ¢ä¸ºMegatronæ ¼å¼çš„.binå’Œ.idxæ–‡ä»¶ã€‚

- `wiki.train.tokens` è½¬ä¸º `jsonl`æ ¼å¼æ•°æ®

ç”¨æˆ·éœ€è¦**è‡ªè¡Œå°†`wiki.train.tokens`æ•°æ®é›†å¤„ç†æˆjsonlæ ¼å¼çš„æ–‡ä»¶**ã€‚ä½œä¸ºå‚è€ƒï¼Œæ–‡æ¡£æœ«å°¾çš„[FAQ](#faq)éƒ¨åˆ†æä¾›äº†ä¸€ä¸ªä¸´æ—¶è½¬æ¢æ–¹æ¡ˆï¼Œç”¨æˆ·éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è‡ªè¡Œå¼€å‘å’ŒéªŒè¯è½¬æ¢é€»è¾‘ã€‚

ä¸‹é¢æ˜¯jsonlæ ¼å¼æ–‡ä»¶çš„ç¤ºä¾‹ï¼š

```json
{"src": "www.nvidia.com", "text": "The quick brown fox", "type": "Eng", "id": "0", "title": "First Part"}
{"src": "The Internet", "text": "jumps over the lazy dog", "type": "Eng", "id": "42", "title": "Second Part"}
...
```

- `jsonl`æ ¼å¼æ•°æ® è½¬ä¸º `bin`æ ¼å¼æ•°æ®

MindSpore Transformersæä¾›äº†æ•°æ®é¢„å¤„ç†è„šæœ¬`toolkit/data_preprocess/megatron/preprocess_indexed_dataset.py`ç”¨äºå°†jsonlæ ¼å¼çš„åŸå§‹æ–‡æœ¬é¢„æ–™è½¬æ¢æˆ.binæˆ–.idxæ–‡ä»¶ã€‚

> è¿™é‡Œéœ€è¦æå‰ä¸‹è½½[TeleChat3-105B-A4.7B](https://huggingface.co/TeleChat/TeleChat3-105B-A4.7B)æ¨¡å‹çš„tokenizeræ–‡ä»¶ã€‚

ä¾‹å¦‚ï¼š

```shell
python toolkit/data_preprocess/megatron/preprocess_indexed_dataset.py \
  --input /path/to/data.jsonl \
  --output-prefix /path/to/wiki103-megatron \
  --tokenizer-type HuggingFaceTokenizer \
  --tokenizer-dir /path/to/TeleChat3-105B-A4.7B # å…¶ä»–è§„æ ¼çš„æ¨¡å‹å¯ä»¥è°ƒæ•´ä¸ºå¯¹åº”çš„tokenizerè·¯å¾„
```

> è¿è¡Œå®Œæˆåä¼šç”Ÿæˆ`/path/to/wiki103-megatron_text_document.bin`å’Œ`/path/to/wiki103-megatron_text_document.idx`æ–‡ä»¶ã€‚
> å¡«å†™æ•°æ®é›†è·¯å¾„æ—¶éœ€è¦ä½¿ç”¨`/path/to/wiki103-megatron_text_document`ï¼Œä¸éœ€è¦å¸¦åç¼€åã€‚

#### 2. ä¿®æ”¹ä»»åŠ¡é…ç½®

MindSpore Transformers æä¾›äº†é¢„è®­ç»ƒä»»åŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®æ–‡ä»¶ç‰‡æ®µï¼Œç”¨æˆ·éœ€è¦æ ¹æ®è‡ªå·±çš„æ•°æ®é›†è·¯å¾„å’Œå…¶ä»–å‚æ•°è¿›è¡Œç›¸åº”ä¿®æ”¹ã€‚

- æ•°æ®é›†é…ç½®

```yaml
# Dataset configuration
train_dataset: &train_dataset
  data_loader:
    ...
    sizes:
      - 8000  # æ•°æ®é›†çš„å¤§å°ï¼Œå¯ä»¥æ ¹æ®å®é™…æ•°æ®é›†å¤§å°è¿›è¡Œè°ƒæ•´
      ...
    config:
      ...
      data_path:  # é‡‡æ ·æ¯”ä¾‹å’ŒMegatronæ ¼å¼æ•°æ®é›†è·¯å¾„
        - '1'
        - "/path/to/wiki103-megatron_text_document" # æ›¿æ¢ä¸ºå®é™…çš„Megatronæ ¼å¼æ•°æ®é›†è·¯å¾„ï¼Œæ­¤å¤„ä¸å¸¦åç¼€å
```

æ•°æ®é›†è·¯å¾„éœ€è¦æ›¿æ¢ä¸ºå®é™…çš„Megatronæ ¼å¼æ•°æ®é›†è·¯å¾„ã€‚

ä¸åŒè§„æ ¼å’Œåºåˆ—é•¿åº¦çš„å¹¶è¡Œé…ç½®å¯å‚è€ƒ[å¹¶è¡Œé…ç½®å»ºè®®](#å¹¶è¡Œé…ç½®å»ºè®®)ã€‚

#### 3. å¯åŠ¨é¢„è®­ç»ƒä»»åŠ¡

é€šè¿‡æŒ‡å®šæ¨¡å‹è·¯å¾„å’Œé…ç½®æ–‡ä»¶[configs/telechat3/pretrain_telechat3_105b_a4b_4k.yaml](https://gitee.com/mindspore/mindformers/blob/master/configs/telechat3/pretrain_telechat3_105b_a4b_4k.yaml)ä»¥`msrun`çš„æ–¹å¼å¯åŠ¨[run_mindformer.py](https://gitee.com/mindspore/mindformers/blob/master/run_mindformer.py)è„šæœ¬ï¼Œè¿›è¡Œ16å¡åˆ†å¸ƒå¼è®­ç»ƒã€‚æ‚¨å¯å‚è€ƒå¦‚ä¸‹æ–¹å¼ï¼Œæ‹‰èµ·ä¸¤å°Atlas 800T A2ï¼ˆ64Gï¼‰è®­ç»ƒã€‚

åœ¨æ¯å°æœåŠ¡å™¨ä¸Šæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ã€‚è®¾ç½®`master_ip`ä¸ºä¸»èŠ‚ç‚¹IPåœ°å€ï¼Œå³`Rank 0`æœåŠ¡å™¨çš„IPï¼›`node_rank`ä¸ºæ¯ä¸ªèŠ‚ç‚¹çš„åºå·ï¼›`port`ä¸ºå½“å‰è¿›ç¨‹çš„ç«¯å£å·ï¼ˆå¯åœ¨50000~65536ä¸­é€‰æ‹©ï¼‰ã€‚

```shell
master_ip=192.168.1.1
node_rank=0
port=50001
bash scripts/msrun_launcher.sh "run_mindformer.py \
--config configs/telechat3/pretrain_telechat3_105b_a4b_4k.yaml \
--auto_trans_ckpt False \
--use_parallel True \
--run_mode train" \
48 8 $master_ip $port $node_rank output/msrun_log False 7200
```

> æ­¤å¤„æ ·ä¾‹ä»£ç å‡è®¾ä¸»èŠ‚ç‚¹ä¸º`192.168.1.1`ã€å½“å‰Rankåºå·ä¸º`0`ã€‚å®é™…æ‰§è¡Œæ—¶è¯·å°†`master_ip`è®¾ç½®ä¸ºå®é™…çš„ä¸»èŠ‚ç‚¹IPåœ°å€ï¼›å°†`node_rank`è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„Rankåºå·ï¼›å°†`port`è®¾ç½®ä¸ºå½“å‰è¿›ç¨‹çš„ç«¯å£å·ã€‚

ä¸Šè¿°å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œè®­ç»ƒä»»åŠ¡å°†åœ¨åå°æ‰§è¡Œï¼Œè¿‡ç¨‹æ—¥å¿—ä¿å­˜åœ¨`./output/msrun_log`ä¸‹ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯æŸ¥çœ‹è®­ç»ƒçŠ¶æ€ï¼ˆç”±äºå¼€å¯äº†æµæ°´å¹¶è¡Œï¼ŒçœŸå®lossåªæ˜¾ç¤ºåœ¨æœ€åä¸€ä¸ªpipeline stageçš„æ—¥å¿—ä¸­ï¼Œå…¶ä½™pipeline stageä¼šæ˜¾ç¤º`loss`ä¸º`0`ï¼‰

```shell
tail -f ./output/msrun_log/worker_0.log
```

è®­ç»ƒè¿‡ç¨‹ä¸­çš„æƒé‡checkpointå°†ä¼šä¿å­˜åœ¨`./output/checkpoint`ä¸‹ã€‚

å¦‚æœ‰å…³äºTeleChat3é¢„è®­ç»ƒçš„ç›¸å…³é—®é¢˜ï¼Œå¯ä»¥åœ¨MindSpore Transformersçš„Giteeä»“åº“ä¸­[æäº¤ISSUE](https://gitee.com/mindspore/mindformers/issues/new)ä»¥è·å–æ”¯æŒã€‚

## é™„å½•

### æ¨¡å‹æ–‡ä»¶è¯´æ˜

TeleChat3-105Bçš„æ¨¡å‹æ–‡ä»¶åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

```text
ğŸ“¦mindformers
â”œâ”€â”€ ğŸ“‚mindformers
â”‚   â””â”€â”€ ğŸ“‚models
â”‚       â””â”€â”€ ğŸ“‚TeleChat3
â”‚           â”œâ”€â”€ ğŸ“„__init__.py                       # TeleChat3æ¨¡å—åˆå§‹åŒ–æ–‡ä»¶
â”‚           â”œâ”€â”€ ğŸ“„configuration_telechat3.py        # TeleChat3æ¨¡å‹é…ç½®ç±»å®šä¹‰
â”‚           â”œâ”€â”€ ğŸ“„modeling_telechat3.py             # TeleChat3æ¨¡å‹ä¸»ä½“å®ç°
â”‚           â”œâ”€â”€ ğŸ“„modeling_telechat3_train.py       # TeleChat3è®­ç»ƒæ¨¡å‹å®ç°
â”‚           â””â”€â”€ ğŸ“„utils.py                          # TeleChat3å·¥å…·å‡½æ•°å’ŒåŸºç¡€ç±»
â”œâ”€â”€ ğŸ“‚configs
â”‚   â””â”€â”€ ğŸ“‚telechat3
â”‚       â”œâ”€â”€ ğŸ“„pretrain_telechat3_105b_a4b_4k.yaml   # TeleChat3-105B-A4.7B 4k é¢„è®­ç»ƒé…ç½®
â”‚       â””â”€â”€ ğŸ“„parallel_speed_up.json                # æ•°æ®é›†å¹¶è¡Œé€šä¿¡é…ç½®
â””â”€â”€ ğŸ“„run_mindformer.py                             # ä¸»è¦æ‰§è¡Œè„šæœ¬
```

### å¹¶è¡Œé…ç½®å»ºè®®

ä»¥ä¸‹é…ç½®ä¸ºè®­ç»ƒæˆ–æ¨ç†åœºæ™¯ä¸‹ï¼Œä¸åŒæ¨¡å‹è§„æ ¼çš„æ¨èé…ç½®ã€‚å…¶ä¸­éƒ¨åˆ†é…ç½®ä¸ºç»è¿‡éªŒè¯çš„æœ€ä½³é…ç½®ï¼Œéƒ¨åˆ†é…ç½®ä¸ºå¯ä»¥è¿è¡Œçš„é…ç½®ã€‚ç”¨æˆ·å¯æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„é…ç½®ã€‚

> æ³¨æ„ï¼šmax_device_memory åœ¨ Atlas 800T A2 å’Œ Atlas 900 A3 SuperPoD ç­‰æœºå™¨ä¸Šä¸€èˆ¬è®¾ç½®â‰¤60GBï¼Œåœ¨ Atlas 800I A2 ä¸Šä¸€èˆ¬è®¾ç½®â‰¤30GBã€‚

- é¢„è®­ç»ƒï¼š

<table>
  <tr>
    <th>æ¨¡å‹</th>
    <th>è§„æ ¼</th>
    <th>è®¾å¤‡</th>
    <th>å¡æ•°</th>
    <th>åºåˆ—é•¿åº¦</th>
    <th>å¹¶è¡Œé…ç½®</th>
    <th>é‡è®¡ç®—é…ç½®</th>
    <th>å†…å­˜é…ç½®</th>
    <th>æ¨¡å‹çº§åˆ«</th>
  </tr>
  <tr>
    <td>TeleChat3</td>
    <td>105B</td>
    <td>6 Ã— Atlas 800T A2 (8P)</td>
    <td>48</td>
    <td>4096</td>
    <td>
      <pre><code class="language-yaml">parallel_config:
  data_parallel: &dp 1
  model_parallel: 8
  pipeline_stage: 6
  micro_batch_num: 4
  vocab_emb_dp: True
  use_seq_parallel: False
  gradient_aggregation_group: 1</code></pre>
    </td>
    <td>
      <pre><code class="language-yaml">recompute_config:
  recompute: True
  select_recompute: False
  parallel_optimizer_comm_recompute: True
  mp_comm_recompute: True</code></pre>
    </td>
    <td>
      <pre><code class="language-yaml">context:
  ...
  max_device_memory: "58GB"</code></pre>
    </td>
    <td> Validated </td>
  </tr>
</table>

### FAQ

Q1ï¼šæˆ‘æœ‰ä¸¤å°Atlas 800T A2æœåŠ¡å™¨ï¼Œå¦‚ä½•è¿›è¡ŒTeleChat3çš„é¢„è®­ç»ƒï¼Ÿæ‹‰èµ·ä»»åŠ¡çš„æŒ‡ä»¤æ˜¯ä»€ä¹ˆï¼Ÿ

A1ï¼šæ ¹æ®æŒ‡å¯¼ä¿®æ”¹é…ç½®åï¼Œå‚è€ƒå¦‚ä¸‹å‘½ä»¤æ‹‰èµ·ä»»åŠ¡ï¼š

- æœºå™¨1 IP: 192.168.1.1 ï¼ˆä½œä¸ºä¸»èŠ‚ç‚¹ï¼‰

```bash
# æœºå™¨1çš„å¯åŠ¨æŒ‡ä»¤
master_ip=192.168.1.1
node_rank=0
port=50001

bash scripts/msrun_launcher.sh "run_mindformer.py \
--config configs/TeleChat3/pretrain_TeleChat3_32b_4k.yaml \
--auto_trans_ckpt False \
--use_parallel True \
--run_mode train" \
16 8 $master_ip $port $node_rank output/msrun_log False 7200
```

- æœºå™¨2 IP: 192.168.1.2

```bash
# æœºå™¨2çš„å¯åŠ¨æŒ‡ä»¤
master_ip=192.168.1.1
node_rank=1
port=50001

bash scripts/msrun_launcher.sh "run_mindformer.py \
--config configs/telechat3/pretrain_TeleChat3_30b_a3b_4k.yaml \
--auto_trans_ckpt False \
--use_parallel True \
--run_mode train" \
16 8 $master_ip $port $node_rank output/msrun_log False 7200
```

Q2: æ•°æ®é›†å‡†å¤‡éƒ¨åˆ†ä¸­ï¼Œåº”è¯¥å¦‚ä½•å°†`wiki.train.tokens` è½¬ä¸º `jsonl`æ ¼å¼æ•°æ®ï¼Ÿ

A2: [ç¤¾åŒºissue](https://gitee.com/mindspore/mindformers/issues/ICOKGY)ä¸­æä¾›äº†ä¸€ä¸ªä¸´æ—¶è½¬æ¢è„šæœ¬ï¼Œä»…ä½œä¸ºå‚è€ƒä½¿ç”¨ã€‚ç”¨æˆ·éœ€è¦æ ¹æ®è‡ªå·±çš„æ•°æ®ç‰¹ç‚¹å’Œéœ€æ±‚ï¼Œè‡ªè¡Œå¼€å‘å’ŒéªŒè¯é€‚åˆçš„è½¬æ¢é€»è¾‘ã€‚

Q3ï¼šå¦‚æœä¿®æ”¹äº†é…ç½®ä¸­çš„å‚æ•°ï¼Œä½¿ç”¨`run_mindformer.py`æ‹‰èµ·ä»»åŠ¡æ—¶ï¼Œè¿˜éœ€è¦é‡æ–°ä¼ å‚å—ï¼Ÿ

A3ï¼šæ ¹æ®æŒ‡å¯¼ä¿®æ”¹é…ç½®åï¼Œå‚æ•°å€¼å·²è¢«ä¿®æ”¹ï¼Œæ— éœ€é‡å¤ä¼ å‚ï¼Œ`run_mindformer.py`ä¼šè‡ªåŠ¨è¯»å–è§£æé…ç½®ä¸­çš„å‚æ•°ï¼›å¦‚æœæ²¡æœ‰ä¿®æ”¹é…ç½®ä¸­çš„å‚æ•°ï¼Œåˆ™éœ€è¦åœ¨å‘½ä»¤ä¸­æ·»åŠ å‚æ•°ã€‚