<!--æ¨¡å‹READMEæ¨¡æ¿-->

# [æ¨¡å‹åç§°]

## æ¨¡å‹æè¿°

[ç®€è¦æè¿°æ¨¡å‹çš„å‘å¸ƒè€…ã€ä¼˜åŠ¿ã€åŠŸèƒ½å’Œç”¨é€”ã€‚æ·»åŠ å¼•ç”¨ä¿¡æ¯ã€‚]

## æ”¯æŒè§„æ ¼

| æ¨¡å‹åç§° | è§„æ ¼ |   æ”¯æŒä»»åŠ¡    |     æ¨¡å‹æ¶æ„     |                       æ”¯æŒè®¾å¤‡                        |                       æ¨¡å‹çº§åˆ«                        |
|:----:|:--:|:---------:|:------------:|:-------------------------------------------------:|:-------------------------------------------------:|
|  XX  | xB | é¢„è®­ç»ƒ/å¾®è°ƒ/æ¨ç† | Mcore/Legacy | Atlas 800T A2/Atlas 800I A2/Atlas 900 A3 SuperPoD | Released/Validated/Preliminary/Untested/Community |

è¯´æ˜ï¼š

- æ¨¡å‹æ¶æ„ï¼š`Mcore` è¡¨ç¤º 1.6.0 å‘å¸ƒçš„æ–°æ¨¡å‹æ¶æ„ï¼Œ`Legacy` è¡¨ç¤ºåŸæœ‰æ¨¡å‹æ¶æ„ã€‚è¯¦è§[æ¶æ„è¯´æ˜](https://www.mindspore.cn/mindformers/docs/zh-CN/master/introduction/overview.html)ã€‚
- æ¨¡å‹çº§åˆ«ï¼šè®­ç»ƒå’Œæ¨ç†å„åˆ†ä¸º5ä¸ªçº§åˆ«ï¼Œåˆ†åˆ«ä»£è¡¨è¯¥æ¨¡å‹éµå¾ªä¸åŒçš„æ ‡å‡†ä¸Šçº¿ã€‚æ¯ä¸ªçº§åˆ«çš„ä»‹ç»è¯¦è§[æ¨¡å‹çº§åˆ«ä»‹ç»](https://gitee.com/mindspore/mindformers/blob/master/README_CN.md#æ¨¡å‹çº§åˆ«ä»‹ç»)ã€‚

[æ ‡é¢˜é‡ŒMcoreé¦–å­—æ¯å¤§å†™ï¼Œæ­£æ–‡é‡Œå‡ºç°ä½¿ç”¨å°å†™]

## ç‰ˆæœ¬é…å¥—

[æ¨¡å‹åç§°] å½“å‰æ¨èä½¿ç”¨å’Œé¦–æ¬¡æ”¯æŒçš„ç‰ˆæœ¬é…å¥—å¦‚ä¸‹ã€‚å½“å‰æ¨èä½¿ç”¨çš„ç‰ˆæœ¬ä¸€èˆ¬æ˜¯æœ€æ–°çš„ç»è¿‡éªŒè¯çš„ç‰ˆæœ¬ã€‚å¦‚æ— ç‰¹æ®Šè¯´æ˜ï¼Œé¦–æ¬¡æ”¯æŒçš„ç‰ˆæœ¬åˆ°æ¨èä½¿ç”¨çš„ç‰ˆæœ¬ä¹‹é—´çš„ç‰ˆæœ¬å‡å¯ä»¥ä½¿ç”¨ã€‚

|           | MindSpore Transformers | MindSpore | CANN | HDK |
|:---------:|:----------------------:|:---------:|:----:|:---:|
| å½“å‰æ¨èä½¿ç”¨çš„ç‰ˆæœ¬ |           xx           |    xx     |  xx  | xx  |
|  é¦–æ¬¡æ”¯æŒçš„ç‰ˆæœ¬  |           xx           |    xx     |  xx  | xx  |

## ä½¿ç”¨æ ·ä¾‹

MindSpore Transformers æ”¯æŒä½¿ç”¨ [æ¨¡å‹åç§°] è¿›è¡Œé¢„è®­ç»ƒã€å¾®è°ƒå’Œæ¨ç†ã€‚å„ä»»åŠ¡çš„æ•´ä½“ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š

| ä»»åŠ¡  | å‰æœŸå‡†å¤‡                    | ä½¿ç”¨æµç¨‹                       |
|:---:|:------------------------|:---------------------------|
| é¢„è®­ç»ƒ | ç¯å¢ƒå®‰è£… -> é¢„è®­ç»ƒæ•°æ®é›†ä¸‹è½½        | æ•°æ®é¢„å¤„ç† -> ä¿®æ”¹ä»»åŠ¡é…ç½® -> å¯åŠ¨é¢„è®­ç»ƒä»»åŠ¡ |
| å¾®è°ƒ  | ç¯å¢ƒå®‰è£… -> æ¨¡å‹ä¸‹è½½ -> å¾®è°ƒæ•°æ®é›†ä¸‹è½½ | æ•°æ®é¢„å¤„ç† -> ä¿®æ”¹ä»»åŠ¡é…ç½® -> å¯åŠ¨å¾®è°ƒä»»åŠ¡  |
| æ¨ç†  | ç¯å¢ƒå®‰è£… -> æ¨¡å‹ä¸‹è½½            | ä¿®æ”¹ä»»åŠ¡é…ç½® -> å¯åŠ¨æ¨ç†ä»»åŠ¡           |

### å‰æœŸå‡†å¤‡

#### ç¯å¢ƒå®‰è£…

æŒ‰ç…§ä¸Šè¿°ç‰ˆæœ¬é…å¥—ï¼Œå‚è€ƒ[ç¯å¢ƒå®‰è£…æŒ‡å—](https://www.mindspore.cn/mindformers/docs/zh-CN/master/installation.html)å®‰è£…è¿è¡Œç¯å¢ƒã€‚

#### æ¨¡å‹ä¸‹è½½

ç”¨æˆ·å¯ä»¥ä»Modelersã€Hugging Faceã€ModelScopeç­‰å¼€æºç¤¾åŒºä¸‹è½½æ‰€éœ€çš„æ¨¡å‹æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ¨¡å‹æƒé‡ã€Tokenizerã€é…ç½®ç­‰ï¼ˆé‡å¤´é¢„è®­ç»ƒä¸éœ€åŠ è½½æƒé‡ï¼‰ã€‚é“¾æ¥å¦‚ä¸‹ï¼š

|    æ¨¡å‹åç§°    | ä¸‹è½½é“¾æ¥                                             | è¯´æ˜ |
|:----------:|:-------------------------------------------------|:---|
|   XXX-xB   | [Modelers]() / [Hugging Face]() / [ModelScope]() |    |
|   XXX-xB   | [Modelers]() / [Hugging Face]() / [ModelScope]() |    |
| XXX-xB-AxB | [Modelers]() / [Hugging Face]() / [ModelScope]() |    |

#### æ•°æ®é›†ä¸‹è½½

MindSpore Transformers ä»¥ä¸‹é¢çš„æ•°æ®é›†ä¸ºä¾‹æä¾›äº† [æ¨¡å‹åç§°] çš„é¢„è®­ç»ƒå’Œå¾®è°ƒæµç¨‹çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œå®é™…è®­ç»ƒæ—¶å¯å‚è€ƒ[æ•°æ®é›†](https://www.mindspore.cn/mindformers/docs/zh-CN/master/feature/dataset.html)ç« èŠ‚åˆ¶ä½œæ•°æ®é›†ã€‚è¯·åœ¨æ‰§è¡Œä»»åŠ¡å‰æå‰ä¸‹è½½æ‰€éœ€æ•°æ®é›†ã€‚é“¾æ¥å¦‚ä¸‹ï¼š

| ä»»åŠ¡  |    æ•°æ®é›†åç§°     | ä¸‹è½½é“¾æ¥         | è¯´æ˜ |
|:---:|:------------:|:-------------|:---|
| é¢„è®­ç»ƒ | WikiText-103 | [Download]() |    |
| å¾®è°ƒ  |    Alpaca    | [Download]() |    |

### é¢„è®­ç»ƒæ ·ä¾‹

[å¯¹é¢„è®­ç»ƒä»»åŠ¡å¢åŠ å¿…è¦è¯´æ˜ï¼ŒåŒ…æ‹¬ä½¿ç”¨åœºæ™¯ã€ä½¿ç”¨çº¦æŸå’Œé™åˆ¶]

#### 1. æ•°æ®é¢„å¤„ç†

[æ ¹æ®å®é™…æƒ…å†µï¼Œæ¸…æ¥šå†™å‡ºæ•°æ®é¢„å¤„ç†çš„æ­¥éª¤å’Œå‘½ä»¤ã€‚]

#### 2. ä¿®æ”¹ä»»åŠ¡é…ç½®

[ç»™å‡ºä¿®æ”¹çš„yamlæ–‡ä»¶åå’Œé“¾æ¥ï¼ŒæŒ‰ä¿®æ”¹å«ä¹‰åˆ†ç‚¹å½’ç±»å†™å‡ºä¿®æ”¹çš„é…ç½®é¡¹å’Œå«ä¹‰ï¼Œå¯¹é…ç½®é¡¹è¿›è¡Œå¿…è¦è¯´æ˜]

ä¸åŒè§„æ ¼å’Œåºåˆ—é•¿åº¦çš„å¹¶è¡Œé…ç½®å¯å‚è€ƒ[å¹¶è¡Œé…ç½®å»ºè®®](#å¹¶è¡Œé…ç½®å»ºè®®)ã€‚

#### 3. å¯åŠ¨é¢„è®­ç»ƒä»»åŠ¡

[ç»™å‡ºå¯åŠ¨é¢„è®­ç»ƒä»»åŠ¡çš„å‘½ä»¤ï¼Œæ³¨æ„å‘½ä»¤ä¸­éœ€è¦åŒ…å«å¿…è¦çš„å‚æ•°å’Œé…ç½®æ–‡ä»¶è·¯å¾„ã€‚ç„¶åè¯´æ˜å¦‚ä½•æŸ¥çœ‹æ—¥å¿—å’Œç»“æœã€‚æœ€åè¯´æ˜å…³äºé¢„è®­ç»ƒçš„é€šç”¨ä½¿ç”¨æ–¹æ³•å’Œç›¸å…³ç‰¹æ€§ä»‹ç»è¯·å‚è€ƒå®˜ç½‘é¢„è®­ç»ƒæ–‡æ¡£ã€‚]

```bash
bash scripts/msrun_launcher.sh "run_mindformer.py \
--config configs/{model_name}/pretrain_{model_name}.yaml \
--auto_trans_ckpt False \
--use_parallel True \
--parallel_config.data_parallel 1 \
--parallel_config.model_parallel 8 \
--run_mode train"
```

### å¾®è°ƒæ ·ä¾‹

[å¯¹å¾®è°ƒä»»åŠ¡å¢åŠ å¿…è¦è¯´æ˜ï¼ŒåŒ…æ‹¬ä½¿ç”¨åœºæ™¯ã€ä½¿ç”¨çº¦æŸå’Œé™åˆ¶]

#### 1. æ•°æ®é¢„å¤„ç†

[æ ¹æ®å®é™…æƒ…å†µï¼Œæ¸…æ¥šå†™å‡ºæ•°æ®é¢„å¤„ç†çš„æ­¥éª¤å’Œå‘½ä»¤ã€‚]

#### 2. ä¿®æ”¹ä»»åŠ¡é…ç½®

[ç»™å‡ºä¿®æ”¹çš„yamlæ–‡ä»¶åå’Œé“¾æ¥ï¼ŒæŒ‰ä¿®æ”¹å«ä¹‰åˆ†ç‚¹å½’ç±»å†™å‡ºä¿®æ”¹çš„é…ç½®é¡¹å’Œå«ä¹‰ï¼Œå¯¹é…ç½®é¡¹è¿›è¡Œå¿…è¦è¯´æ˜]

ä¸åŒè§„æ ¼å’Œåºåˆ—é•¿åº¦çš„å¹¶è¡Œé…ç½®å¯å‚è€ƒ[å¹¶è¡Œé…ç½®å»ºè®®](#å¹¶è¡Œé…ç½®å»ºè®®)ã€‚

#### 3. å¯åŠ¨å¾®è°ƒä»»åŠ¡

[ç»™å‡ºå¯åŠ¨å¾®è°ƒä»»åŠ¡çš„å‘½ä»¤ï¼Œæ³¨æ„å‘½ä»¤ä¸­éœ€è¦åŒ…å«å¿…è¦çš„å‚æ•°å’Œé…ç½®æ–‡ä»¶è·¯å¾„ã€‚ç„¶åè¯´æ˜å¦‚ä½•æŸ¥çœ‹æ—¥å¿—å’Œç»“æœã€‚æœ€åè¯´æ˜å…³äºå¾®è°ƒçš„é€šç”¨ä½¿ç”¨æ–¹æ³•å’Œç›¸å…³ç‰¹æ€§ä»‹ç»è¯·å‚è€ƒå®˜ç½‘å¾®è°ƒæ–‡æ¡£ã€‚]

```bash
bash scripts/msrun_launcher.sh "run_mindformer.py \
--config configs/{model_name}/pretrain_{model_name}.yaml \
--pretrained_model_dir /path/to/pretrained_model
--auto_trans_ckpt True \
--use_parallel True \
--parallel_config.data_parallel 1 \
--parallel_config.model_parallel 8 \
--run_mode finetune"
```

### æ¨ç†æ ·ä¾‹

[å¯¹æ¨ç†ä»»åŠ¡å¢åŠ å¿…è¦è¯´æ˜ï¼ŒåŒ…æ‹¬ä½¿ç”¨åœºæ™¯ã€ä½¿ç”¨çº¦æŸå’Œé™åˆ¶]

#### 1. ä¿®æ”¹ä»»åŠ¡é…ç½®

[ç»™å‡ºä¿®æ”¹çš„yamlæ–‡ä»¶åå’Œé“¾æ¥ï¼ŒæŒ‰ä¿®æ”¹å«ä¹‰åˆ†ç‚¹å½’ç±»å†™å‡ºä¿®æ”¹çš„é…ç½®é¡¹å’Œå«ä¹‰ï¼Œå¯¹é…ç½®é¡¹è¿›è¡Œå¿…è¦è¯´æ˜]

ä¸åŒè§„æ ¼çš„å¹¶è¡Œé…ç½®å¯å‚è€ƒ[å¹¶è¡Œé…ç½®å»ºè®®](#å¹¶è¡Œé…ç½®å»ºè®®)ã€‚

#### 2. å¯åŠ¨æ¨ç†ä»»åŠ¡

[ç»™å‡ºå¯åŠ¨æ¨ç†ä»»åŠ¡çš„å‘½ä»¤ï¼Œæ³¨æ„å‘½ä»¤ä¸­éœ€è¦åŒ…å«å¿…è¦çš„å‚æ•°å’Œé…ç½®æ–‡ä»¶è·¯å¾„ã€‚ç„¶åè¯´æ˜å¦‚ä½•æŸ¥çœ‹æ—¥å¿—å’Œç»“æœã€‚æœ€åè¯´æ˜å…³äºæ¨ç†çš„é€šç”¨ä½¿ç”¨æ–¹æ³•å’Œç›¸å…³ç‰¹æ€§ä»‹ç»è¯·å‚è€ƒå®˜ç½‘æ¨ç†æ–‡æ¡£ã€‚]

```shell
bash scripts/msrun_launcher.sh "run_mindformer.py \
 --config configs/{model_name}/pretrain_{model_name}.yaml \
 --run_mode predict \
 --use_parallel True \
 --pretrained_model_dir /path/to/pretrained_model \
 --parallel_config.data_parallel 1 \
 --parallel_config.model_parallel 8 \
 --predict_data 'å¸®åŠ©æˆ‘åˆ¶å®šä¸€ä»½å»ä¸Šæµ·çš„æ—…æ¸¸æ”»ç•¥'" 2
```

## é™„å½•

### æ¨¡å‹æ–‡ä»¶è¯´æ˜

[æ¨¡å‹åç§°]çš„æ¨¡å‹æ–‡ä»¶åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

```text
ğŸ“¦mindformers
â”œâ”€â”€ ğŸ“‚mindformers
â”‚   â”œâ”€â”€ ğŸ“„xx.py
â”‚   â””â”€â”€ ğŸ“‚xx         # [ç›®å½•è¯´æ˜]
â”‚       â”œâ”€â”€ ğŸ“„xx.py  # [æ–‡ä»¶è¯´æ˜]
â”‚       â””â”€â”€ ğŸ“„xx.py  # [æ–‡ä»¶è¯´æ˜]
â”œâ”€â”€ ğŸ“‚xx
â”‚   â””â”€â”€ ğŸ“„xx.yaml
â””â”€â”€ ğŸ“„xx.xx
```

[ç¬¦å·å»ºè®®ï¼šğŸ“¦ æ ¹ç›®å½• / ğŸ“‚ æ–‡ä»¶å¤¹ / ğŸ“„ æ–‡ä»¶ï¼Œç”¨ â”œâ”€â”€ å’Œ â””â”€â”€ è¡¨ç¤ºå±‚çº§åˆ†æ”¯]

### å¹¶è¡Œé…ç½®å»ºè®®

ä»¥ä¸‹é…ç½®ä¸ºè®­ç»ƒæˆ–æ¨ç†åœºæ™¯ä¸‹ï¼Œä¸åŒæ¨¡å‹è§„æ ¼çš„æ¨èé…ç½®ã€‚å…¶ä¸­éƒ¨åˆ†é…ç½®ä¸ºç»è¿‡éªŒè¯çš„æœ€ä½³é…ç½®ï¼Œéƒ¨åˆ†é…ç½®ä¸ºå¯ä»¥è¿è¡Œçš„é…ç½®ã€‚ç”¨æˆ·å¯æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„é…ç½®ã€‚

> æ³¨æ„ï¼šmax_device_memory åœ¨ Atlas 800T A2 ä¸Šä¸€èˆ¬è®¾ç½®â‰¤60GBï¼Œåœ¨ Atlas 800I A2 ä¸Šä¸€èˆ¬è®¾ç½®â‰¤30GBã€‚

- è®­ç»ƒï¼š

<table>
  <tr>
    <th>æ¨¡å‹</th>
    <th>è§„æ ¼</th>
    <th>è®¾å¤‡</th>
    <th>å¡æ•°</th>
    <th>åºåˆ—é•¿åº¦</th>
    <th>å¹¶è¡Œé…ç½®</th>
    <th>é‡è®¡ç®—é…ç½®</th>
    <th>å†…å­˜é…ç½®</th>
    <th>æ¨¡å‹çº§åˆ«</th>
  </tr>
  <tr>
    <td>XX</td>
    <td>xxB</td>
    <td>1 Ã— Atlas 800T A2 (8P)</td>
    <td>8</td>
    <td>4096</td>
    <td>
      <pre><code class="language-yaml">parallel_config:
  data_parallel: &dp 2
  model_parallel: 2
  pipeline_stage: 2
  micro_batch_num: 1
  vocab_emb_dp: True
  use_seq_parallel: False
  gradient_aggregation_group: 1</code></pre>
    </td>
    <td>
      <pre><code class="language-yaml">recompute_config:
  recompute: True
  select_recompute: False
  parallel_optimizer_comm_recompute: True
  mp_comm_recompute: True
  recompute_slice_activation: True</code></pre>
    </td>
    <td>
      <pre><code class="language-yaml">context:
  ...
  max_device_memory: "58GB"</code></pre>
    </td>
    <td> Validated </td>
  </tr>
</table>

- æ¨ç†ï¼š

<table>
  <tr>
    <th>æ¨¡å‹</th>
    <th>è§„æ ¼</th>
    <th>è®¾å¤‡</th>
    <th>å¡æ•°</th>
    <th>åºåˆ—é•¿åº¦</th>
    <th>å¹¶è¡Œé…ç½®</th>
    <th>å†…å­˜é…ç½®</th>
    <th>æ¨¡å‹çº§åˆ«</th>
  </tr>
  <tr>
    <td>XX</td>
    <td>xxB</td>
    <td>1 Ã— Atlas 800T A2 (8P)</td>
    <td>8</td>
    <td>4096</td>
    <td>
      <pre><code class="language-yaml">parallel_config:
  data_parallel: &dp 1
  model_parallel: 8</code></pre>
    </td>
    <td>
      <pre><code class="language-yaml">context:
  ...
  max_device_memory: "58GB"</code></pre>
    </td>
    <td> Validated </td>
  </tr>
</table>

### FAQ

Q1ï¼š[ä»¥ç”¨æˆ·çš„è§’åº¦æå‡ºé—®é¢˜ï¼Œæ³¨æ„é—®é¢˜è¦ä¾¿äºç”¨æˆ·ç†è§£ï¼Œæœ‰é€‚å½“èƒŒæ™¯è¯´æ˜]

A1ï¼š[ç»™å‡ºè§£ç­”æˆ–è§£å†³æ–¹æ³•ï¼Œè§£å†³æ–¹æ³•éœ€è¦å‡†ç¡®ã€æ¸…æ™°ï¼Œä¾¿äºç”¨æˆ·ç†è§£å’Œæ“ä½œã€‚æ— æ³•ç›´æ¥è§£å†³çš„é—®é¢˜å¯ä»¥ç»™å‡ºç›¸å…³é“¾æ¥æˆ–issueè”ç³»æ–¹å¼ã€‚]

æ›´å¤šFAQè¯·æŸ¥çœ‹[å®˜ç½‘FAQ](https://www.mindspore.cn/mindformers/docs/zh-CN/master/faq/model_related.html)